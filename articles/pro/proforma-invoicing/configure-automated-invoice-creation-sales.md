---
title: 請求書自動作成の設定
description: このトピックは、見積もり請求の自動作成の設定と構成に関する情報を提供します。
author: rumant
ms.date: 04/05/2021
ms.topic: article
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 2d212f2279b28d900e75d45386e343f95b8e825e
ms.sourcegitcommit: 40f68387f594180af64a5e5c748b6efa188bd300
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/10/2021
ms.locfileid: "6004177"
---
# <a name="set-up-automatic-invoice-creation"></a>請求書自動作成の設定 
 
_**適用対象:** ライト展開 - 見積請求、リソース/非在庫ベースのシナリオ向けの Project Operations_

Dynamics 365 Project Operations で請求書自動作成を構成することができます。 システムは、プロジェクト契約および契約品目ごとの請求スケジュールに基づいて、ドラフトの見積送り状を作成します。 請求スケジュールは、契約品目レベルで設定します。 契約の各品目に異なる請求スケジュールを設定するか、契約のすべての品目に同じ請求スケジュールを設定することができます。

請求書を作成すると、システムは常にプロジェクト契約ごとに少なくとも 1 つの請求書を作成します。 場合によっては、複数の請求書が作成される場合があります。 たとえば、複数の顧客が存在する契約であれば、そのプロジェクト契約で請求する請求可能なトランザクションを持つ顧客の数と同じ数の請求書が作成されます。

## <a name="understand-how-transactions-are-included-on-an-invoice"></a>トランザクションがどのように請求書の含まれるかを理解する 

プロジェクト ベースの契約品目ごとに、個別の請求書スケジュールが指定されている場合もあります。 たとえば、Adatum 契約の実装サービスには、次のような契約品目があります :

- 手動で作成された 2 つのマイルストーンを使用した固定価格のプロトタイプ作業。
- 時間を含み、隔週で月曜日に請求される実装作業。
- 毎月第一月曜日に請求する必要がある費用が発生した場合。

これら 2 つのライン項目のそれぞれに定義された請求書スケジュールは、次の表のようになります :

| 契約品目 | 請求書の実行日 | トランザクション締め日 | マイルストーンの日付 | マイルストーンの金額 |
| --- | --- | --- | --- | --- |
| プロトタイプの作業 | 10 月 5 日、月曜日 | - | 10 月 5 日、月曜日 | 5000 米ドル |
| - | 11 月 3 日、火曜日 | - | 11 月 3 日、火曜日 | 12,000 米ドル |
| 実装作業 | 10 月 5 日、月曜日 | 10 月 4 日、日曜日 | - | - |
| - | 10 月 19 日、月曜日 | 10 月 18 日、日曜日 | - | - |
| - | 11 月 2 日、月曜日 | 11 月 1 日、月曜日 | - | - |
| - | 11 月 16 日、月曜日 | 11 月 15 日、日曜日 | - | - |
| 発生した費用 | 10 月 5 日、月曜日 | 10 月 4 日、日曜日 | - | - |
| - | 11 月 2 日、月曜日 | 11 月 1 日、月曜日 | - | - |

この例では、自動請求が実行されるタイミング :

- **10 月 4 日またはそれ以前の日付**: この契約品目の **請求書スケジュール** テーブルでは、10 月 4 日 (日) が請求書の実行日として指定されていないため、この契約の請求書は生成されません。
- **10 月 5 日 (月)**: 次の場合に請求書が 1 枚生成されます :

    - マイルストーンを含むプロトタイプ作業 (**請求書の発行準備完了** とマークされている場合)。
    - 10 月 4 日 (日)のトランザクション締切日より前に作成された、**請求書の発行準備完了** とマークされている全てのタイム トランザクションを含む実装作業。
    - 10 月 4 日 (日) のトランザクション締切日より前に作成された、**請求書の発行準備完了** とマークされている全ての経費トランザクションを含む発生した経費。
  
- **10 月 6 日または 10 月 19 日以前のいずれかの日付**：これらの各契約品目の **請求書スケジュール** テーブルでは、10 月 6 日または 10 月 19 日以前のいずれかの日を請求書の実行日として指定していないため、この契約では請求書は生成されません。
- **10 月 19 日 (月)** : 10 月 18 日 (日) のトランザクション締切日よりも前に作成されたすべてのタイム トランザクションを含む実装作業のために 1 つの請求書が生成され、**請求書の発行準備完了** とマークされます。
- **11 月 2 日 (月)**: 次の場合に請求書が 1 枚生成されます :

    - 11 月 1 日 (日) のトランザクション締切日以前に作成された、**請求書の発行準備完了** とマークされている全てのタイム トランザクションを含む実装作業。
    - 11 月 1 日 (日)のトランザクション締切日より前に作成された、**請求書の発行準備完了** とマークされている全ての経費トランザクションを含む発生した経費。

- **11 月 3 日 (火)**：12000 USDのマイルストーンを含むプロトタイプ作業に対して、**請求書の発行準備完了** とマークされている場合は、1枚の請求書が生成されます。

## <a name="configure-automatic-invoicing"></a>請求書の自動発行を構成する

請求書の自動発行を設定するには、以下の手順を完了します。

1. **Project Operations** で、**設定** > **定期的な請求書の設定** に移動します。
2. バッチ ジョブを作成して、 **Poject Operations 請求書の作成** と名前をつけます。 バッチ ジョブの名前には、「請求書の作成」という語句を含めてください。
3. **ジョブの種類** フィールドで、 **なし** を選択します。 既定では、 **頻度 毎日** および **アクティブ** フィールドが **はい** に設定されています。
4. **ワークフローの実行** を選択します。 **レコードの検索** ダイアログ ボックスに、次の 3 つのワークフローが表示されます。

- ProcessRunCaller
- ProcessRunner
- UpdateRoleUtilization

5. **ProcessRunCaller** を選択して、**追加** を選択します。
6. 次のダイアログ ボックスで、**OK** を選択します。 **スリープ** ワークフローの後に **プロセス** ワークフローになります。 

> [!NOTE]
> ステップ 5 で **ProcessRunner** を選択することもできます。 **OK** を選択すると、 **プロセス** ワークフロー の後には、 **スリープ** ワークフローが続きます。

**ProcessRunCaller** および **ProcessRunner** ワークフローは、請求書を作成します。 **ProcessRunCaller** は **ProcessRunner** を呼び出します。 **ProcessRunner** は、実際に請求書を作成するワークフローです。 ワークフローは、請求書を作成する必要のあるすべての契約品目を通過し、それらの品目の請求書を作成します。 契約書を作成する契約品目を決定するために、ジョブは契約品目の請求書の実行日を参照します。 1 つの契約に属する契約品目の請求実行日が同じ場合、トランザクションは 2 つの請求品目を持つ 1 つの請求書に統合されます。 請求書を作成するトランザクションがない場合、ジョブは請求書の作成をスキップします。

**ProcessRunner** の実行が完了すると、 **ProcessRunCaller** を呼び出して、終了時間が指定されてクローズされます。 **ProcessRunCaller** では、指定した終了時刻から 24 時間のタイマーを起動します。 タイマーが終了すると、 **ProcessRunCaller** が閉じられます。

請求書を作成するバッチ処理ジョブは反復ジョブです。 このバッチ処理を何度も実行すると、ジョブのインスタンスが複数作成され、エラーが発生します。 したがって、バッチ処理は 1 度だけ起動し、起動が止まった場合にのみ再起動するようにしてください。

> [!NOTE]
> Project Operations の一括請求書発行は、請求書スケジュールによって構成されたプロジェクトの契約品目に対してのみ実行されます。 固定価格の請求方法の契約品目には、マイルストーンを構成する必要があります。 時間と材料の請求方法を持つプロジェクト契約品目には、日付ベースの請求スケジュールを設定する必要があります。


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
