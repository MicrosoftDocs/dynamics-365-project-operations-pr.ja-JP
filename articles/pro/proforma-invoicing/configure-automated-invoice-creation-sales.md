---
title: 請求書自動作成の設定
description: このトピックは、見積もり請求の自動作成の設定と構成に関する情報を提供します。
author: rumant
ms.date: 04/05/2021
ms.topic: article
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 2d212f2279b28d900e75d45386e343f95b8e825e
ms.sourcegitcommit: 40f68387f594180af64a5e5c748b6efa188bd300
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/10/2021
ms.locfileid: "6004177"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="71100-103">請求書自動作成の設定</span><span class="sxs-lookup"><span data-stu-id="71100-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="71100-104">_**適用対象:** ライト展開 - 見積請求、リソース/非在庫ベースのシナリオ向けの Project Operations_</span><span class="sxs-lookup"><span data-stu-id="71100-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="71100-105">Dynamics 365 Project Operations で請求書自動作成を構成することができます。</span><span class="sxs-lookup"><span data-stu-id="71100-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="71100-106">システムは、プロジェクト契約および契約品目ごとの請求スケジュールに基づいて、ドラフトの見積送り状を作成します。</span><span class="sxs-lookup"><span data-stu-id="71100-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="71100-107">請求スケジュールは、契約品目レベルで設定します。</span><span class="sxs-lookup"><span data-stu-id="71100-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="71100-108">契約の各品目に異なる請求スケジュールを設定するか、契約のすべての品目に同じ請求スケジュールを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="71100-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="71100-109">請求書を作成すると、システムは常にプロジェクト契約ごとに少なくとも 1 つの請求書を作成します。</span><span class="sxs-lookup"><span data-stu-id="71100-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="71100-110">場合によっては、複数の請求書が作成される場合があります。</span><span class="sxs-lookup"><span data-stu-id="71100-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="71100-111">たとえば、複数の顧客が存在する契約であれば、そのプロジェクト契約で請求する請求可能なトランザクションを持つ顧客の数と同じ数の請求書が作成されます。</span><span class="sxs-lookup"><span data-stu-id="71100-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="71100-112">トランザクションがどのように請求書の含まれるかを理解する</span><span class="sxs-lookup"><span data-stu-id="71100-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="71100-113">プロジェクト ベースの契約品目ごとに、個別の請求書スケジュールが指定されている場合もあります。</span><span class="sxs-lookup"><span data-stu-id="71100-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="71100-114">たとえば、Adatum 契約の実装サービスには、次のような契約品目があります :</span><span class="sxs-lookup"><span data-stu-id="71100-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="71100-115">手動で作成された 2 つのマイルストーンを使用した固定価格のプロトタイプ作業。</span><span class="sxs-lookup"><span data-stu-id="71100-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="71100-116">時間を含み、隔週で月曜日に請求される実装作業。</span><span class="sxs-lookup"><span data-stu-id="71100-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="71100-117">毎月第一月曜日に請求する必要がある費用が発生した場合。</span><span class="sxs-lookup"><span data-stu-id="71100-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="71100-118">これら 2 つのライン項目のそれぞれに定義された請求書スケジュールは、次の表のようになります :</span><span class="sxs-lookup"><span data-stu-id="71100-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="71100-119">契約品目</span><span class="sxs-lookup"><span data-stu-id="71100-119">Contract line</span></span> | <span data-ttu-id="71100-120">請求書の実行日</span><span class="sxs-lookup"><span data-stu-id="71100-120">Invoice run date</span></span> | <span data-ttu-id="71100-121">トランザクション締め日</span><span class="sxs-lookup"><span data-stu-id="71100-121">Transaction cut-off date</span></span> | <span data-ttu-id="71100-122">マイルストーンの日付</span><span class="sxs-lookup"><span data-stu-id="71100-122">Milestone date</span></span> | <span data-ttu-id="71100-123">マイルストーンの金額</span><span class="sxs-lookup"><span data-stu-id="71100-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="71100-124">プロトタイプの作業</span><span class="sxs-lookup"><span data-stu-id="71100-124">Prototype work</span></span> | <span data-ttu-id="71100-125">10 月 5 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-125">October 5, Monday</span></span> | - | <span data-ttu-id="71100-126">10 月 5 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-126">October 5, Monday</span></span> | <span data-ttu-id="71100-127">5000 米ドル</span><span class="sxs-lookup"><span data-stu-id="71100-127">5000 USD</span></span> |
| - | <span data-ttu-id="71100-128">11 月 3 日、火曜日</span><span class="sxs-lookup"><span data-stu-id="71100-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="71100-129">11 月 3 日、火曜日</span><span class="sxs-lookup"><span data-stu-id="71100-129">November 3, Tuesday</span></span> | <span data-ttu-id="71100-130">12,000 米ドル</span><span class="sxs-lookup"><span data-stu-id="71100-130">12,000 USD</span></span> |
| <span data-ttu-id="71100-131">実装作業</span><span class="sxs-lookup"><span data-stu-id="71100-131">Implementation work</span></span> | <span data-ttu-id="71100-132">10 月 5 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-132">October 5, Monday</span></span> | <span data-ttu-id="71100-133">10 月 4 日、日曜日</span><span class="sxs-lookup"><span data-stu-id="71100-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="71100-134">10 月 19 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-134">October 19, Monday</span></span> | <span data-ttu-id="71100-135">10 月 18 日、日曜日</span><span class="sxs-lookup"><span data-stu-id="71100-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="71100-136">11 月 2 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-136">November 2, Monday</span></span> | <span data-ttu-id="71100-137">11 月 1 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="71100-138">11 月 16 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-138">November 16, Monday</span></span> | <span data-ttu-id="71100-139">11 月 15 日、日曜日</span><span class="sxs-lookup"><span data-stu-id="71100-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="71100-140">発生した費用</span><span class="sxs-lookup"><span data-stu-id="71100-140">Expenses incurred</span></span> | <span data-ttu-id="71100-141">10 月 5 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-141">October 5, Monday</span></span> | <span data-ttu-id="71100-142">10 月 4 日、日曜日</span><span class="sxs-lookup"><span data-stu-id="71100-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="71100-143">11 月 2 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-143">November 2, Monday</span></span> | <span data-ttu-id="71100-144">11 月 1 日、月曜日</span><span class="sxs-lookup"><span data-stu-id="71100-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="71100-145">この例では、自動請求が実行されるタイミング :</span><span class="sxs-lookup"><span data-stu-id="71100-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="71100-146">**10 月 4 日またはそれ以前の日付**: この契約品目の **請求書スケジュール** テーブルでは、10 月 4 日 (日) が請求書の実行日として指定されていないため、この契約の請求書は生成されません。</span><span class="sxs-lookup"><span data-stu-id="71100-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="71100-147">**10 月 5 日 (月)**: 次の場合に請求書が 1 枚生成されます :</span><span class="sxs-lookup"><span data-stu-id="71100-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="71100-148">マイルストーンを含むプロトタイプ作業 (**請求書の発行準備完了** とマークされている場合)。</span><span class="sxs-lookup"><span data-stu-id="71100-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="71100-149">10 月 4 日 (日)のトランザクション締切日より前に作成された、**請求書の発行準備完了** とマークされている全てのタイム トランザクションを含む実装作業。</span><span class="sxs-lookup"><span data-stu-id="71100-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="71100-150">10 月 4 日 (日) のトランザクション締切日より前に作成された、**請求書の発行準備完了** とマークされている全ての経費トランザクションを含む発生した経費。</span><span class="sxs-lookup"><span data-stu-id="71100-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="71100-151">**10 月 6 日または 10 月 19 日以前のいずれかの日付**：これらの各契約品目の **請求書スケジュール** テーブルでは、10 月 6 日または 10 月 19 日以前のいずれかの日を請求書の実行日として指定していないため、この契約では請求書は生成されません。</span><span class="sxs-lookup"><span data-stu-id="71100-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="71100-152">**10 月 19 日 (月)** : 10 月 18 日 (日) のトランザクション締切日よりも前に作成されたすべてのタイム トランザクションを含む実装作業のために 1 つの請求書が生成され、**請求書の発行準備完了** とマークされます。</span><span class="sxs-lookup"><span data-stu-id="71100-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="71100-153">**11 月 2 日 (月)**: 次の場合に請求書が 1 枚生成されます :</span><span class="sxs-lookup"><span data-stu-id="71100-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="71100-154">11 月 1 日 (日) のトランザクション締切日以前に作成された、**請求書の発行準備完了** とマークされている全てのタイム トランザクションを含む実装作業。</span><span class="sxs-lookup"><span data-stu-id="71100-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="71100-155">11 月 1 日 (日)のトランザクション締切日より前に作成された、**請求書の発行準備完了** とマークされている全ての経費トランザクションを含む発生した経費。</span><span class="sxs-lookup"><span data-stu-id="71100-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="71100-156">**11 月 3 日 (火)**：12000 USDのマイルストーンを含むプロトタイプ作業に対して、**請求書の発行準備完了** とマークされている場合は、1枚の請求書が生成されます。</span><span class="sxs-lookup"><span data-stu-id="71100-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="71100-157">請求書の自動発行を構成する</span><span class="sxs-lookup"><span data-stu-id="71100-157">Configure automatic invoicing</span></span>

<span data-ttu-id="71100-158">請求書の自動発行を設定するには、以下の手順を完了します。</span><span class="sxs-lookup"><span data-stu-id="71100-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="71100-159">**Project Operations** で、**設定** > **定期的な請求書の設定** に移動します。</span><span class="sxs-lookup"><span data-stu-id="71100-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="71100-160">バッチ ジョブを作成して、 **Poject Operations 請求書の作成** と名前をつけます。</span><span class="sxs-lookup"><span data-stu-id="71100-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="71100-161">バッチ ジョブの名前には、「請求書の作成」という語句を含めてください。</span><span class="sxs-lookup"><span data-stu-id="71100-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="71100-162">**ジョブの種類** フィールドで、 **なし** を選択します。</span><span class="sxs-lookup"><span data-stu-id="71100-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="71100-163">既定では、 **頻度 毎日** および **アクティブ** フィールドが **はい** に設定されています。</span><span class="sxs-lookup"><span data-stu-id="71100-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="71100-164">**ワークフローの実行** を選択します。</span><span class="sxs-lookup"><span data-stu-id="71100-164">Select **Run Workflow**.</span></span> <span data-ttu-id="71100-165">**レコードの検索** ダイアログ ボックスに、次の 3 つのワークフローが表示されます。</span><span class="sxs-lookup"><span data-stu-id="71100-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="71100-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="71100-166">ProcessRunCaller</span></span>
- <span data-ttu-id="71100-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="71100-167">ProcessRunner</span></span>
- <span data-ttu-id="71100-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="71100-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="71100-169">**ProcessRunCaller** を選択して、**追加** を選択します。</span><span class="sxs-lookup"><span data-stu-id="71100-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="71100-170">次のダイアログ ボックスで、**OK** を選択します。</span><span class="sxs-lookup"><span data-stu-id="71100-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="71100-171">**スリープ** ワークフローの後に **プロセス** ワークフローになります。</span><span class="sxs-lookup"><span data-stu-id="71100-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="71100-172">ステップ 5 で **ProcessRunner** を選択することもできます。</span><span class="sxs-lookup"><span data-stu-id="71100-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="71100-173">**OK** を選択すると、 **プロセス** ワークフロー の後には、 **スリープ** ワークフローが続きます。</span><span class="sxs-lookup"><span data-stu-id="71100-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="71100-174">**ProcessRunCaller** および **ProcessRunner** ワークフローは、請求書を作成します。</span><span class="sxs-lookup"><span data-stu-id="71100-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="71100-175">**ProcessRunCaller** は **ProcessRunner** を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="71100-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="71100-176">**ProcessRunner** は、実際に請求書を作成するワークフローです。</span><span class="sxs-lookup"><span data-stu-id="71100-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="71100-177">ワークフローは、請求書を作成する必要のあるすべての契約品目を通過し、それらの品目の請求書を作成します。</span><span class="sxs-lookup"><span data-stu-id="71100-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="71100-178">契約書を作成する契約品目を決定するために、ジョブは契約品目の請求書の実行日を参照します。</span><span class="sxs-lookup"><span data-stu-id="71100-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="71100-179">1 つの契約に属する契約品目の請求実行日が同じ場合、トランザクションは 2 つの請求品目を持つ 1 つの請求書に統合されます。</span><span class="sxs-lookup"><span data-stu-id="71100-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="71100-180">請求書を作成するトランザクションがない場合、ジョブは請求書の作成をスキップします。</span><span class="sxs-lookup"><span data-stu-id="71100-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="71100-181">**ProcessRunner** の実行が完了すると、 **ProcessRunCaller** を呼び出して、終了時間が指定されてクローズされます。</span><span class="sxs-lookup"><span data-stu-id="71100-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="71100-182">**ProcessRunCaller** では、指定した終了時刻から 24 時間のタイマーを起動します。</span><span class="sxs-lookup"><span data-stu-id="71100-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="71100-183">タイマーが終了すると、 **ProcessRunCaller** が閉じられます。</span><span class="sxs-lookup"><span data-stu-id="71100-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="71100-184">請求書を作成するバッチ処理ジョブは反復ジョブです。</span><span class="sxs-lookup"><span data-stu-id="71100-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="71100-185">このバッチ処理を何度も実行すると、ジョブのインスタンスが複数作成され、エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="71100-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="71100-186">したがって、バッチ処理は 1 度だけ起動し、起動が止まった場合にのみ再起動するようにしてください。</span><span class="sxs-lookup"><span data-stu-id="71100-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="71100-187">Project Operations の一括請求書発行は、請求書スケジュールによって構成されたプロジェクトの契約品目に対してのみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="71100-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="71100-188">固定価格の請求方法の契約品目には、マイルストーンを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="71100-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="71100-189">時間と材料の請求方法を持つプロジェクト契約品目には、日付ベースの請求スケジュールを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="71100-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
