---
title: 価格設定エンティティとトランザクション エンティティにユーザー定義フィールドを追加する
description: このトピックでは、価格設定エンティティとトランザクション エンティティに対してカスタム フィールドを追加する方法について説明します。
author: Rumant
ms.custom:
- dyn365-projectservice
ms.date: 10/01/2020
ms.topic: article
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365PS
- ProjectOperations
ms.openlocfilehash: 3ca48b8d5d55b1b2178f9bd84e19d9599f057aa296a728cca57577c18fdaf307
ms.sourcegitcommit: 7f8d1e7a16af769adb43d1877c28fdce53975db8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2021
ms.locfileid: "6985777"
---
# <a name="add-custom-fields-to-price-setup-and-transactional-entities"></a>価格設定エンティティとトランザクション エンティティにユーザー定義フィールドを追加する 

[!include [banner](../includes/psa-now-project-operations.md)]

このトピックの内容は、 [ユーザー定義のフィールドとエンティティを作成する](create-custom-fields-entities.md) のトピックに記載された内容を完了していることが前提となっています。 次に、これらの手順を完了していない場合は、戻ってこれらを完了してから、このトピックに戻ってください。 

このトピックでは、必要なユーザー定義フィールド参照をエンティティーおよびフォームやビューなどのユーザー インターフェース(UI) の要素に追加する手順を説明します。

## <a name="add-custom-pricing-dimension-fields"></a>価格設定ディメンション ユーザー定義フィールドを追加する 
ユーザー定義フィールドとエンティティを作成したら、次の手順では、参照フィールドを作成して、価格設定エンティティと取引エンティティにユーザー定義エンティティまたはオプションセットを認識させます。 価格設定ディメンション リストにオプション セット ディメンションまたはエンティティ ディメンション、あるいはその両方が含まれているかどうかを判断の上で、 **オプション セット ベースの ユーザー定義の価格設定ディメンション** または **エンティティ ベースの ユーザー定義の価格設定ディメンション** の手順、あるいはその両方の手順に従ってください。

### <a name="option-set-based-custom-pricing-dimensions"></a>オプション セット ベースのユーザー定義の価格設定ディメンション
ユーザー定義の価格設定ディメンションがオプション セット ベースの場合は、キーとなる Project Service エンティティにフィールドとして追加します。 以下の手順では、オプション セット ベースの価格設定ディメンションとして **リソースの作業場所** および **リソースの作業時間** が使用されます。 **ロールの価格** と **ロール価格の利幅** これらは、まずフィールドとして価格設定エンティティに追加する必要があります。

1. Project Service Automation (PSA) で、**設定** > **ソリューション** をクリックし、**\<your organization name> 価格設定ディメンション** をダブルクリックします。 
2. ソリューション エクスプローラーの左側のナビゲーションパネルで、 **エンティティ > ロールの価格** を選択します。
3. **役割価格** エンティティを展開して **フィールド** を選択します。
4. **新規** をクリックして **リソースの作業場所** という新しいフィールドを作成し、フィールドタイプとして **オプション セット** を選択します。 
5. **既存のオプション セットを使用する** を選択し、 **リソースの作業場所** オプション セットを選択し、 **保存** をクリックします。
6. 手順1 - 5を繰り返し、 **ロール価格の利幅** エンティティにこのフィールドを追加します。 
7. 手順1 - 5を繰り返し、 **リソースの作業時間** オプション セットを追加します。

> [!IMPORTANT]
> 複数のエンティティにフィールドを追加する際には、すべてのエンティティで共通のフィールド名を使用してください。 

> ![リソースの作業場所をロール価格に追加する。](media/RWL-Field.png)

プロジェクトの販売フェーズと見積フェーズでは、作業量の見積もりが必要となります。これを完了するには、 **標準時間** と **残業時間**  の枠組みの中で **ローカル** 作業と **オンサイト** 作業を使用して、見積/プロジェクトの値を予測します。 **リソースの作業場所** と **リソースの作業時間** フィールドが、見積エンティティ、**見積依頼明細行の詳細**、**契約品目明細**、**プロジェクト タスク**、**プロジェクト・チーム・メンバー**、**見積行** に追加されます。

1. PSA で、**設定** > **ソリューション** をクリックし、続いて **\<your organization name> 価格ディメンション** をダブルクリックします。 
2. ソリューション エクスプローラーの左側のナビゲーションパネルで、 **エンティティ > 見積品目明細** を選択します。
3. **見積品目明細** エンティティを展開し、 **フィールド** 選択します。
4. **新規** をクリックして **リソースの作業場所** という新しいフィールドを作成し、フィールドタイプには **オプション セット** を選択します。 
5. **既存のオプション セットを使用する** と **リソースの作業場所** オプション セットを選択し、 **保存** をクリックします。
6. 手順1 - 5 を繰り返し、**プロジェクト契約品目の詳細**、**プロジェクト タスク**、**プロジェクト チーム メンバー**、**見積行** エンティティにこのフィールドを追加します。
7. 手順1 - 6を繰り返し、 **リソースの作業時間** オプション セットを追加します。 

> ![リソースの作業場所を見積もり明細に追加する。](media/RWL-Default-Value.png)


出荷および請求には、完了した作業が正確に価格設定される必要があります。そのためには作業が **ローカル** または **オンサイト** のどちらで行われたか、および プロジェクト実績の **通常時間** または **超過時間** のどちらで完了したかを選択します。 **リソースの作業場所** と **リソースの作業時間** フィールドを、 **時間エントリ**、 **実績**、 **請求品目の明細**、 **仕訳帳明細行** エンティティに追加する必要があります。

1. PSA で、**設定** > **ソリューション** をクリックし、続いて **\<your organization name> 価格ディメンション** をダブルクリックします。
2. ソリューション エクスプローラーの左側のナビゲーションパネルで、 **エンティティ > 時間エントリ** を選択します。
3. **見積品目明細** エンティティを展開し、 **フィールド** 選択します。
4. **新規** をクリックして **リソースの作業場所** という新しいフィールドを作成し、フィールドタイプとして **オプション セット** を選択します。 
5. **既存のオプション セットを使用する** を選択し、 **リソースの作業場所** オプション セットを選択し、 **保存** をクリックします。
6. 手順1 - 5を繰り返し、 **実績**、 **請求品目の明細**、 **仕訳帳明細行** エンティティにこのフィールドを追加します。
7. 手順1 - 6を繰り返し、 **リソースの作業時間** オプション セットを追加します。 

> ![リソースの作業場所を時間エントリに追加する。](media/RWL-time-entry.png)

これにより、オプション セット ベースのカスタム ディメンションに必要なスキーマの変更が完了します。

## <a name="entity-based-custom-pricing-dimensions"></a>エンティティ ベースのユーザー定義の価格設定ディメンション

ユーザー定義の価格設定ディメンションがエンティティの場合は、ディメンション エンティティと主要な Project Service エンティティの間に1:Nの関係性を追加します。 前述の スタンダード タイトル の例では、各従業員にスタンダード タイトルが割り当てられることが期待できます。 その結果、スタンダード タイトル から 予約可能なリソース への1:Nの関係、または 予約可能なリソース からスタンダード タイトルへのN:1関係が必要になります。

1. PSA で、**設定** > **ソリューション** をクリックし、続いて **\<your organization name> 価格ディメンション** をダブルクリックします。 
2. ソリューション エクスプローラーの左側のナビゲーションパネルで、 **エンティティ > スタンダード タイトル** を選択します。
3. **スタンダード タイトル** エンティティを展開し、 **1: Nの関連付け** を選択します。
4. **新規** をクリックし、 **予約可能なリソースに対するスタンダード タイトル** として新たな1:Nの関係性を作成します。 その他の必要情報を入力し、 **保存** をクリックします。

> ![スタンダード タイトルを参照フィールドとして予約可能なリソースに追加する。](media/ST-BR.png)

スタンダード タイトルは、Project Service 価格設定エンティティの **ロールの価格** 、 **ロール価格の利幅** に追加する必要があります。 これは、 **スタンダード タイトル** エンティティと **ロールの価格** エンティティ、および **スタンダード タイトル** エンティティと **ロール価格の利幅** エンティティ間の1:Nの関係を使用しても完了します。

1. ソリューション エクスプローラーの左側のナビゲーションパネルで、 **エンティティ > スタンダード タイトル** を選択します。
2. **スタンダード タイトル** エンティティを展開し、 **1: Nの関連付け** を選択します。
3. **新規** をクリックし、 **ロールの価格に対するスタンダード タイトル** として新たな1:Nの関係性を作成します。 その他の必要情報を入力し、 **保存** をクリックします。
4. 手順1 - 4を繰り返し、 **スタンダード タイトル** エンティティ と **ロール価格の利幅** エンティティ間に1:Nの関連付けを作成します。

プロジェクトの販売および見積フェーズでは、見積/プロジェクトの価格を設定するために、スタンダード タイトルごとに作業量の見積が必要となります。 これは、スタンダード タイトルから Project Service 内のこれらの見積エンティティのそれぞれに1:Nの関係が必要であることを意味します: 

- **見積品目明細**
- **プロジェクト契約品目の詳細**
- **プロジェクト タスク**
- **プロジェクト チーム メンバー**
- **見積行**

5. 手順 1 - 5 を繰り返し、**スタンダード タイトル** から **見積品目明細**、**プロジェクト契約品目の詳細**、**プロジェクト タスク**、**プロジェクト チーム メンバー**、**見積行** に対して 1:N の関連付けを作成します。

> ![スタンダード タイトルを参照フィールドとして見積もり明細に追加する。](media/ST-Estimate-Line.png)

出荷フェーズと請求フェーズでは、各スタンダード タイトルによって完了された作業が、プロジェクト実績に正確な価格設定がされている必要があります。 つまり、 **スタンダード タイトル** と **時間エントリ**、 **実績**、 **請求書品目明細**、 **仕訳帳明細行** の間に1:N の関連付けが設定されている必要があります。

6. 手順1 - 6 を繰り返し、 **スタンダード タイトル** と **時間エントリ**、 **実績**、 **請求書品目明細**、 **仕訳帳明細行** の間に1:N の関連付けを設定します。

> ![スタンダード タイトルを参照フィールドとして時間エントリに追加する。](media/ST-Mapping.png)

### <a name="set-up-dimension-value-defaulting-using-the-mappings-features-of-the-platform"></a>プラットフォームのマッピング機能を使用した既定のディメンション値の設定
時間エントリでは、時間入力を記録している 予約可能リソースの時間エントリ のスタンダード タイトルをシステムで既定の設定とすると便利です。 以下の手順に従って、 **予約可能なリソース** から **時間エントリ** の間に設定された 1:N の関連付けにフィールド マッピングを追加します。

1. ソリューション エクスプローラーの左側のナビゲーションパネルで、 **エンティティ > スタンダード タイトル** を選択します。
2. **スタンダード タイトル** エンティティを展開し、 **1: Nの関連付け** を選択します。
3. **時間エントリに対する予約可能なリソース** をダブルクリックします。 **関連付け** ページで、 **フィールド マッピングを使用する** をクリックします。 
4. **新規** をクリックして、 **予約可能なリソース** エンティティの **スタンダード タイトル** フィールドと **スタンダード タイトル** エンティティの **時間エントリ** 参照フィールドの間の新しいフィールドマッピングを作成します。 

> ![スタンダード タイトルを予約可能なリソースから時間エントリにデフォルト設定するためのフィールド マッピングを設定する。](media/ST-Mapping2.png)


これにより、エンティティベースのカスタムディメンションに必要なスキーマの変更が完了します。

##  <a name="add-custom-fields-to-forms-views-and-business-rules"></a>ユーザー定義フィールドをフォーム、ビュー、ビジネスルールに追加する

必要なスキーマの変更をすべて行ったら、フォームとビューにフィールドを追加してUI上にフィールドが表示されるよう設定します。

1. フォームまたはビューを開きます。 右のナビゲーション ウィンドウで、フィールドを選択し、フォームキャンバスにドラッグします。 
2. ビューを編集する場合は、右側のナビゲーション ウィンドウを使用し、 **フィールドの追加**、 **フィールドのリスト** ダイアログ ボックスで必要なフィールドを選択して、 **Ok** をクリックします

以下に、初期状態のフォームとビューのエンティティ別の包括的なリストを示します。これらは新しいフィールドを使用して更新する必要があります。 これらエンティティのカスタマイズに追加のビューまたはフォームがある場合は、それらに対しても新しいフィールドを追加します。

| Project Service エンティティ        | 新しいフィールドが必要なフォーム   |新しいフィールドが必要なビュー      |
| ------------------------------|---------------------------------|----------------------------------|
|  ロール価格|• 情報 |• アクティブなリソース カテゴリ価格<br> • リソース カテゴリ価格関連ビュー|
|  ロール価格利幅|• 情報|• アクティブなロール価格利幅<br>• ロール価格利幅の関連ビュー|
|  見積依頼明細行の詳細|• プロジェクト情報<br>• プロジェクトの簡易作成|• アクティブな見積依頼明細行の詳細<br>• 結合済みの見積依頼明細行の詳細<br>• 見積依頼明細行の詳細関連ビュー|
|  プロジェクト契約品目の詳細|• プロジェクト情報<br>• プロジェクトの簡易作成|• 結合済みの契約品目の詳細<br>• アクティブな契約品目の詳細<br>• 契約品目の詳細と関連するビュー|
|  プロジェクト タスク|• 情報<br>• 新規フォーム||
|  プロジェクト チーム メンバー|• 情報<br>• 新規フォーム|• アクティブなプロジェクト チーム メンバー<br>• プロジェクト チーム メンバー<br>• プロジェクト チーム メンバー関連ビュー|
|  時間入力|• 情報<br>• 時間エントリの作成|• 私の日付別の時間エントリ<br>• 私の今週の時間エントリ<br>• 承認待ちの時間エントリ|
|  仕訳帳明細行|• 情報<br>• 簡易作成|• アクティブな仕訳帳明細行<br>• 仕訳帳明細行関連ビュー|
|  請求明細行の詳細|• 情報<br>• 簡易作成|• アクティブな請求明細行の詳細<br>• 請求可能な請求トランザクション<br>• 無料請求トランザクション<br>• 請求明細行の詳細関連ビュー<br>• 請求不可の請求トランザクション|
|  実績|• 情報<br>• アクティブな実績|• 実績関連ビュー|

定義した内容によっては、カスタム フィールドをビジネス ルールに追加する必要となる場合があります。 デフォルトのビジネス ルールの例としては **ステータスに基づく時間エントリの編集可能性** があります。 このルールでは、時間エントリが **承認済** などの編集不可ステータスの場合にロックする必要があるフィールドを定義します。 時間エントリのステータスが **下書き** または **差し戻し** 以外の場合、フィールドがロックされて編集されないように、このビジネス ルールにフィールドを追加します。


[!INCLUDE[footer-include](../includes/footer-banner.md)]