---
title: プロジェクト ストレージ業務プロセス フロー内をカスタマイズする方法を教えてください。
description: プロジェクト ステージ の ビジネス プロセス フロー をカスタマイズする方法
manager: kfend
ms.service: project-operations
ms.custom:
- dyn365-projectservice
ms.date: 10/11/2018
ms.topic: article
author: JohnPBurrows
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.openlocfilehash: 1d0168f187e6b0880713aac04bd87dbc2209197d
ms.sourcegitcommit: 418fa1fe9d605b8faccc2d5dee1b04b4e753f194
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/10/2021
ms.locfileid: "5149009"
---
# <a name="how-do-i-customize-the-project-stages-business-process-flow"></a>プロジェクト ストレージ業務プロセス フロー内をカスタマイズする方法を教えてください。

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-2-4x-9-0-platform](../includes/cc-applies-to-psa-app-2-4x-9-0-platform.md)]
[!INCLUDE[cc-applies-to-psa-app-1x-8-2-platform](../includes/cc-applies-to-psa-app-1x-8-2-platform.md)]

プロジェクト ステージ業務プロセス フロー内のステージの名前が、想定される英語の名前 (**Quote**、**Plan**、**Close**) と一致させる必要があるという既知の制限が、Project Service アプリケーションの以前のバージョンにはあります。 それ以外の場合は、英語のステージ名に依存するビジネス ロジックが予想どおりに動作しません。 このため、プロジェクト フォームで使用できる **プロセスの切り替え** または **プロセスの編集** など使い慣れたアクションが表示されず、ビジネス プロセス フローのカスタマイズが推奨されません。 

この制限は、バージョン 2.4.5.48 以降で対処されています。 この資料では、以前のバージョンの既定の業務プロセス フローをカスタマイズする必要がある場合に推奨される回避策を示します。  

## <a name="business-logic-requires-an-exact-match-with-english-stage-names"></a>ビジネス ロジックでは、英語のステージ名と完全に一致させる必要があります

プロジェクト ステージ業務プロセス フローには、アプリケーションの動作を制御するビジネス ロジックが含まれます。
- プロジェクトが見積もりに関連付けられると、コードによって業務プロセス フローが **Quote** ステージに設定されます。
- プロジェクトが契約に関連付けられると、コードによって業務プロセス フローが **Plan** ステージに設定されます。
- 業務プロセス フローが **Close** ステージに進むと、プロジェクト レコードが非アクティブ化されます。 プロジェクトが非アクティブ化されると、プロジェクト フォームおよび WBS (作業分解構造)が読み取り専用に設定されて、指定されたリソースの予約が解放され、関連する価格表が非アクティブ化されます。

このビジネス ロジックは、プロジェクト ステージの英語の名前に依存します。 英語名のこの依存関係は、プロジェクト ステージ業務プロセス フローのカスタマイズが推奨されないことと、プロジェクト エンティティに **プロセスの切り替え** または **プロセスの編集** などの一般的なビジネス プロセス フロー アクションが表示されないことの主な理由です。

## <a name="what-happens-if-the-stage-names-dont-match-the-english-names"></a>英語名がステージ名と一致しない場合はどうなりますか?

8.2 プラットフォームにおける Project Service アプリケーション バージョン 1.x では、ビジネス プロセス フローの英語ステージ名が名前に正確に一致しないと、見積もりまたは契約の適切なステージを設定するビジネス ロジック、またはプロジェクトを閉じるビジネス ロジックがスキップされます。 エラー メッセージは表示されません。 したがって、プロジェクト ステージの業務プロセス フローをカスタマイズできます。 ただし、見積もり、契約、プロジェクト終了の自動プロセスは何も表示されません。

9.0 プラットフォームの Project Service アプリ バージョン 2.4.4.30 以前では、業務プロセス フロー内のアーキテクチャが大幅に変更されたため、業務プロセス フロー ビジネス ロジックを書き直す必要があります。 そのため、プロセスのステージ名が必要な英語の名前に一致しない場合、エラー メッセージが表示されます。 

したがって、プロジェクト エンティティのプロジェクト ステージ業務プロセス フローをカスタマイズするには、現状のまま **Quote**、**Plan**、**Close** ステージを保持しながら、プロジェクト エンティティに対する既定の業務プロセス フローに新しいブランド ステージのみ追加します。 この制限は、業務プロセス フローで英語名が期待されるビジネス ロジックでエラーが表示されません。

バージョン 2.4.5.48 以降では、この記事で説明されているビジネス ロジックがプロジェクト エンティティの既定の業務プロセス フローから削除されています。 そのバージョン以降にアップグレードすると、既定の業務プロセス フローをカスタマイズするか、自身のものに置き換えることができます。 

## <a name="workarounds-for-earlier-versions"></a>以前のバージョンの回避策

アップグレードできない場合、次に示す 2 つの方法のいずれかでプロジェクト エンティティのプロジェクト ステージの業務プロセス フローをカスタマイズできます。

1. **Quote**、**Plan**、**Close** の英語ステージ名を保持したまま、既定の構成に追加ステージを追加します。


![既定の構成にステージを追加する方法のスクリーンショット](media/FAQ-Customize-BPF-1.png)
 
2. 独自のビジネス プロセス フローを作成し、必要なステージ名にできるプロジェクト エンティティの主な業務プロセス フローを作成します。 ただし、同じ標準プロジェクト ステージの **Quote**、**Plan**、**Close** を使用する場合、カスタム ステージ名から削除されるいくつかのカスタマイズを実行する必要があります。 複雑なロジックは、プロジェクトの完了にあります。ただし、プロジェクト レコードを非アクティブ化することによってトリガーできます。

![BPF のカスタマイズ](media/FAQ-Customize-BPF-2.png)

### <a name="additional-considerations-for-project-service-app-version-24430-or-earlier-on-platform-90"></a>プラットフォーム 9.0 の Project Service アプリ バージョン 2.4.4.30 以前の追加の考慮事項

カスタム ビジネス プロセス フローを持つプラットフォーム 9.0 の Project Service 2.4.4.30 以前では、**ステージ別プロジェクト** グラフおよびプロジェクト リスト ビューで使用されるプロジェクト エンティティの **ステージ名** フィールドは、既定のプロジェクト ステージ業務プロセス フローと組み合わされていないため更新されません。 以下の手順に従ってこの問題を解決できます。

- カスタム ビジネス プロセスをユーザーが進めるときに、更新された現在の業務プロセス フロー ステージを取得するにはユーザー定義フィールドを追加します。

- 既定の構成ではなく、ユーザー定義フィールドで機能するように **ステージ別プロジェクト** グラフを変更します。

### <a name="steps-to-create-your-own-business-process-flow-for-the-project-entity"></a>プロジェクト エンティティ用に独自の業務プロセス フローを作成する手順

プロジェクト エンティティ用に独自の業務プロセス フローを作成するには、次のようにします。

1. **設定** > **プロセス センター** に移動します。 Project Service ビジネス ロジックもコピーされるため、プロジェクト ステージ業務プロセス フローをコピーしないでください。

  ![プロセスの作成](media/FAQ-Customize-BPF-3.png)

2. プロセス デザイナーを使用して必要なステージ名を作成します。 **Quote**、**Plan**、**Close** の既定のステージと同じ機能が必要な場合、カスタム業務プロセス フローのステージ名に基づいてこのフォルダーを作成する必要があります。

   ![BPF をカスタマイズするのに使用されるプロセス デザイナーのスクリーンショット](media/FAQ-Customize-BPF-4.png) 

3. プロセス デザイナーで、一覧の上部にプロジェクト ステージ業務プロセス フローを移動することで、**受注プロセス フロー** をクリックしてカスタム業務プロセス フローをプロジェクト エンティティの主業務プロセス フローにします。


   [受注プロセス フローの使用のスクリーンショット](media/FAQ-Customize-BPF-5-720.png)

### <a name="the-following-steps-apply-to-project-service-app-24430-or-earlier-on-the-90-platform"></a>以下のステップは、9.0 プラットフォームの Project Service アプリ 2.4.4.30 以前に適用されます

4. カスタム業務プロセス フローのカスタム ステージを取得するためにプロジェクト エンティティに新しいユーザー定義フィールドを追加します。 カスタム業務プロセス フローでステージが更新されたときに、このフィールドを更新するようにビジネス ロジック (プラグイン/ワークフロ) を追加する必要があります。

   ![プロジェクト エンティティのカスタマイズのスクリーンショット](media/FAQ-Customize-BPF-6-720.png)

5. ステージに対して新しいカスタム フィールドを使用するために、**ステージ別プロジェクト** グラフを変更します。

   ![[ステージ別プロジェクト] グラフの使用のスクリーンショット](media/FAQ-Customize-BPF-7-720.png)

6. ステージの新しいカスタム フィールドを含めるにはプロジェクト エンティティのビューを変更します。

   ![プロジェクト エンティティでのビューの変更のスクリーンショット](media/FAQ-Customize-BPF-8-720.png)



[!INCLUDE[footer-include](../includes/footer-banner.md)]