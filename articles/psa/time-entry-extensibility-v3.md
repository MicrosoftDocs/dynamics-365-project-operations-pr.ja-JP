---
title: 毎週の時間エントリをカスタマイズします。
description: このトピックでは、組織のプラクティスをサポートするユーザー定義のビジネス ルールを実行する方法について説明します。
author: stsporen
manager: kfend
ms.service: project-operations
ms.custom:
- dyn365-projectservice
ms.date: 07/09/2019
ms.topic: article
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.openlocfilehash: f1c8e150500334e87b25a1c8d04cf28c7b7beaeb
ms.sourcegitcommit: fa32b1893286f20271fa4ec4be8fc68bd135f53c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/15/2021
ms.locfileid: "5282069"
---
# <a name="customize-weekly-time-entry"></a>週単位の時間エントリをカスタマイズする 

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

Microsoft Dynamics 365 Project Service Automation バージョン 3.3 では、Microsoft が導入したモダン グリッドでプロジェクト リソースを使用すると、一度に最大 1 週間までの時間をクイック入力できます。 新しい週の時間エントリ グリッドには、日付別、行別、週別にエントリの合計を表示できます。 リソースでは、その週の時間エントリのコピーと、その前の週の一括コピーを作成できます。 システム カスタマイザーは、フィールドを追加し、他のエンティティに [検索] を追加し、組織のベスト プラクティスをサポートするユーザー定義のビジネス ルールを実行することにより、ビューをカスタマイズできます。

時間エントリおよび新規の毎週の時間グリッドには、サイト マップを使ってアクセスします。 以前の PSA バージョンの一部であった、ユーザー定義の非拡張の時間エントリ エクスペリエンスは、拡張可能な週単位の時間エントリ グリッドに置き換えられ、また、読み取り専用グリッドとカレンダー内の代替エクスペリエンスに置き換えられました。 この変更によって、ユーザーは週単位で合計時間を入力できます。

## <a name="page-layout"></a>ページ レイアウト
新しい時間エントリ グリッドは、ツールバーと 2 つのメイン セクション、**ディメンション** および **期間** を持つ カスタム コントロールです。 ツールバーには、時間エントリ グリッドの当カスタム コントロールにのみ適用されるボタンが含まれています。 一方、ページ上部のアクションペインのボタンは、時間エントリでサポートされている 3 種類のコントロール（週単位の時間エントリ コントロール、読み取り専用コントロール、およびカレンダーコントロール）に適用されます。

### <a name="dimensions"></a>寸法
**ディメンション** セクションでは、列見出しなど、時間を入力できるすべてのディメンションが表示されます。 次のディメンションは標準でサポートされています。

- プロジェクト
- プロジェクト タスク
- ロール
- 型
- エントリの状態

**ディメンション** セクションではインライン編集はできません。 このセクションは、カスタム フィールドを毎週の時間エントリ グリッドに追加できるように、ビューにより支えられています。 カスタム フィールドを追加する方法については、このトピックの後半の「拡張性」を参照してください。

### <a name="duration"></a>期間
期間セクションには、列見出しとしてその週の曜日が示されます。 このセクションはインライン編集が有効です。 適切なディメンションのある時間エントリ行を作成後、それらのディメンションで使用したインライン、時間数をすばやく入力できます。

## <a name="create-a-new-time-entry"></a>新しい時間エントリを作成します
時間エントリ グリッドで新しい時間エントリを作成するには、**新規** を選択します。 **時間エントリ簡易作成** ダイアログ ボックスが表示されます。 このダイアログ ボックスでは、時間エントリの日付を選択し、 **プロジェクト**、**プロジェクト タスク**、**ロール** および **期間** ディメンションを、分単位、時間単位、あるいは日数単位で数字とともに **h**、**m**、または **d** とデータを入力します。 説明およびコメントを入力して、時間エントリを外部に共有ですることもできます。 変更を保存すると、ディメンションに対して入力した値は、**ディメンション** セクションに表示されます。 **期間** フィールドに入力した期間情報は、時間エントリの作成対象の日付に表示されます。

検索フィールドはシステム ビューに支えられています。 たとえば、ユーザーがプロジェクトを入力すると、**プロジェクト タスク** フィールドは、**コピー** ビューに既定で設定されます。 ユーザーに割り当てられていないタスクの時間エントリを作成するには、検索ダイアログ ボックスの **ビューの変更** を選択し、**すべてのアクティブなプロジェクト タスク** ビューを選択します。

## <a name="edit-a-time-entry"></a>時間エントリの編集
時間エントリ ページでの一部のフィールドの詳細、**説明** と **外部コメント** などは、週単位の時間エントリ グリッドに表示されません。 代わりに、小さな三角の指標が、次の詳細情報がある期間のセルに表示されます。 セルを選択して、**詳細の編集** を選び、 **簡易編集** ウィンドウのデータを表示します。 週単位の時間エントリ グリッドに含まれない特定の時間エントリの詳細を編集または更新するには、**簡易編集** ウィンドウを開く必要があります。

## <a name="copy-a-time-entry-row"></a>時間エントリ行のコピー
時間エントリと行が作成された後、新しい行全体をコピーする場合は、**行をコピー** を選択します。 行がこのようにコピーされると、ディメンション、期間もコピーされます。 **行の編集** を選択して、**期間** セクションのディメンション値と期間をインラインで更新できます。

## <a name="open-a-time-entry"></a>時間エントリを開く
最も目立つフィールドに最適かつ迅速に入力できるようにするために、週単位の時間エントリ グリッドには、選択済みのディメンションと期間のサブセットが表示されます。 単一の時間エントリのすべての情報を **エントリの編集** で表示するには、**開く** を選択します。

## <a name="submit-a-time-entry"></a>時間エントリを送信する
セルのブロックまたは時間エントリ行全体を選択後、**送信する** を選択して、単一の時間エントリまたは時間エントリの単一のグループを送信できます。 送信された時間エントリは、承認者の **承認** ページで承認が保留になっているエントリとして表示されます。 時間エントリが正常に送信されると、編集できなくなります。

## <a name="recall-a-time-entry"></a>時間エントリの取り消し
送信済みの時間エントリを取り消すことができます。 単一の時間エントリ、時間エントリの単一のブロック、または時間エントリ行全体を取り消すことができます。 取り消した時間エントリは編集用リソースとして使用できます。

## <a name="time-entry-status"></a>時間エントリの状態
新しい時間エントリには、**下書き** 状態が自動的に割り当てられます。 時間エントリを送信すると、その状態が **送信済み** に更新されます。 送信した時間エントリが承認されると、その状態が **承認済み** に更新されます。 時間エントリが拒否されると、その状態が **返り値** に更新され、エントリは収集および再送信の対象となります。 **下書き** の状態の時間エントリしか削除できません。

## <a name="view-rejection-comments"></a>拒否のコメントを表示する
時間エントリが承認者に拒否された場合、承認者は、リソースが拒否の理由を理解しやすいように、拒否の理由についてのコメントを付けても構いません。 時間エントリの拒否のコメントを表示するには、**エントリを開く** を選択します。 拒否のコメントはタイムラインに表示されます。 タイムラインで、リソースは、エントリを再送信する前に拒否のコメントに対して返信できます。

## <a name="copy-week"></a>週をコピーする
若干の時間エントリが作成された後、**週をコピーする** を選択して、別の時間エントリを一括作成できます。 **コピー** ダイアログ ボックスが表示されます。 **期間開始** セクションで、**開始日** および **終了日** フィールドを使用して、時間エントリをコピーする場合のコピー元の日付範囲を定義します。 フィールド **終了期間** セクションあるいは **開始日** フィールドで、時間エントリを作成する日付を指定します。 **コピー** を選択します。 「終了」期間で作成済みの日付に対し、「開始」期間の対象の週の、対応する曜日の時間エントリのコピーが作成されます。 たとえば、先週の月曜日の時間エントリは、「終了」期間として指定された週の [月曜日] にコピーされます。

## <a name="import"></a>インポート
同一の基本プロセスが、予約、割り当て、および交換からインポートして使用されます。 予約がインポートされる日付範囲を指定できます。 その後、下書きの時間エントリにコピーすべき予約を明示的に選択する必要があります。 以前のリリースでは、選択した時間エントリはグリッドとカレンダーに表示され、セッションが更新されたときに失われました。

## <a name="extensibility"></a>機能拡張
### <a name="add-custom-fields-that-have-lookups-to-other-entities"></a>他のエンティティに検索対象を持つカスタム フィールドを追加します。
毎週の時間エントリのグリッドにカスタム フィールドを追加する場合、3 つの重要な手順があります。

1.  カスタム フィールドを簡易作成ダイアログ ボックスに追加します。
2.  グリッドを構成し、カスタム フィールドを表示します。
3.  必要に応じて、カスタムフィールドを [行編集タスク フロー] または [セル編集タスク フロー] に追加します。

また、行またはセルの編集タスク フローでは、新しいフィールドの検証が必須であることを確認する必要があります。 この手順の一部として、フィールドをロックする必要があります。これは、時間エントリ状態に基づいて行います。

#### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>カスタム フィールドを簡易作成ダイアログ ボックスに追加します。
[時間エントリ簡易作成ダイアログ ボックス] にカスタム フィールドを追加する必要があります。 **新規** ボタンを使用して時間エントリを追加すると、その値も入力されます。

#### <a name="configure-the-grid-to-show-the-custom-field"></a>グリッドを構成し、カスタム フィールドを表示します。
毎週の時間エントリのグリッドにカスタム フィールドを追加する場合、2 つの重要な手順があります。 最初のオプションとして、**私の週単位の時間エントリ** ビューをカスタマイズして、そこにカスタム フィールドを追加できます。 ビューでこれらのプロパティを編集することによって、グリッドのカスタム フィールドの場所とサイズを選択できます。

2 番目のオプションとしては、新しい時間エントリ カスタム ビューを作成し、既定のビューとして設定することです。 このビューでは、グリッド内の目的の列に加えて、さらに **説明** および **外部コメント** フィールドを含める必要があります。 ビューでこれらのプロパティを編集することによって、グリッドの場所、サイズ、既定の並べ替え順序が選択できます。 次に、**時間エントリ グリッド** コントロールになるように、このビューのカスタム コントロールを設定します。 このコントロールをビューに追加して、Web、携帯電話、タブレットを選択します。 次に、毎週の時間エントリ グリッドのパラメーターを構成します。 **開始日** フィールドを **msdyn_date** に設定し、**期間** フィールドを **msdyn_duration** に設定し、**msdyn_entrystatus** に **状態** フィールドを設定します。 既定のビューで、**読み取り専用状態のリスト** フィールドを **192350002、192350003、192350004** に設定し、**行によるタスク フローの編集** フィールドを **msdyn_timeentryrowedit** に設定し、**セルによるタスク フローの編集** フィールドを **msdyn_timeentryedit** に設定します。 これらのフィールドをカスタマイズして、読み取り専用の状態を追加あるいは削除したり、行またはセルの編集用に別のタスク ベーのエクスペリエンス (TBX) を使用したりできます。 これらのフィールドは静的な値に対して限界があります。

#### <a name="add-the-custom-field-to-the-appropriate-edit-task-flow"></a>カスタム フィールドを適切な編集タスク フローに追加する
編集に使用する TBX ページは、**プロセス** に表示されます。 既定のページ は、**Project Service - 時間エントリ行を編集する** および **Project Service - 時間エントリ編集** です。 これらの既定のページを編集したり、または新しいカスタム TBX ページを作成したりできます。

> [!NOTE] 
> これら 2 つのオプションは両方とも、**プロジェクト** および **プロジェクト タスク** エンティテイの標準フィルターを削除して、エンティティのすべての検索ビューを表示できるようにします。 標準ボックスで、関連する検索ビューのみ表示されます。

カスタム フィールド向けの適切なタスク フローを決定する必要があります。 ほとんどの場合、フィールドをグリッドに追加すると、行編集タスク フローに移動します。これは、時間エントリ行全体に適用するフィールドで使用されます。 カスタム フィールドでは、毎日、**終了時刻** のカスタム フィールドのように一意の値が生成され、一意の値は [セル編集タスク フロー] に移動します。

タスク フローにカスタム フィールドを追加するには、**フィールド** 要素をページの適切な場所にドラッグし、[プロパティ] を設定します。 **ソース** プロパティを **時間エントリ** に設定して、カスタム フィールドに **データ フィールド** プロパティを設定します。 **フィールド** プロパティでは、TBX ページに表示名を指定できます。 **適用** を選択して、フィールドに変更を保存します。 **更新** を選択して、そのページにユーザーの変更を保存します。

新しいユーザー定義の TBX ページを使用するには、新しいプロセスを作成します。 カテゴリを **ビジネス プロセス フロー** に設定し、エンティティを **時間エントリ** に設定し、ビジネス プロセスの種類を **タスク フローとしてプロセスを実行する** に設定します。 **プロパティ** で、**ページ名** プロパティは、そのページの表示名に設定されています。 TBX のページに、すべての関連フィールドを追加します。 プロセスを保存してアクティブ化し、関連タスク フローのカスタム コントロール プロパティを、プロセスの **名前** の値に更新します。

### <a name="add-new-option-set-values"></a>新しいオプション セット値を追加する
オプション セットの値を標準フィールドに追加するには、[フィールドの編集] ページを開き、**種類** で、オプション セットの横にある **編集** を選択します。 次に、ユーザー定義のラベルと色を持つ新しいオプションを追加します。 新しい時間エントリ状態を追加する場合は、標準フィールドは、**エントリ状態** であり、**状態** ではありません。

### <a name="designate-a-new-time-entry-status-as-read-only"></a>読み取り専用として、新しい時間エントリ状態を指定します。
読み取り専用として新しい時間エントリ条件を指定するには、**読み取り専用状態のリスト** プロパティに新しい時間エントリ値 (ラベルではなく数値) を追加します。 時間エントリ グリッドの編集可能な部分は、新規の状態になっている行にロックされます。
次に、**時間エントリ行を編集する** および **時間エントリ編集** の TBX のページで、すべてのフィールドをロックするビジネス ルールを追加します。 ページのビジネス プロセス フロー エディターを開いて **ビジネス ルール** を選択すると、これらのページに関するビジネス ルールにアクセスできます。 既存のビジネス ルールの状況で新しい状態を追加できます。または、新規の状態用に新しいビジネス ルールを追加できます。

### <a name="add-custom-validation-rules"></a>カスタム検証ルールを追加する
毎週の時間エントリ グリッド エクスペリエンスに追加できる検証ルールの種類には、次の 2 種類があります。: •   簡易作成ダイアログ ボックスと TBX ページで機能するクライアント側のビジネス ルール •   すべての時間エントリに適用可能なサーバー側プラグイン検証

#### <a name="business-rules"></a>業務ルール
ビジネス ルールを使用して、フィールドのロックおよびロック解除を行い、既定値をフィールドに入力し、現在の時間エントリ レコードからの情報のみを必要とする検証を定義します。 TBX ページのビジネス ルールにアクセスするには、ページのビジネス プロセス フロー エディターを開き、 **ビジネス ルール** を選択します。 これで、既存のビジネス ルールの編集または新しいビジネス ルールの追加ができるようになります。 さらにカスタマイズされた検証では、JavaScript を実行するビジネス ルールを使用できます。

#### <a name="plug-in-validations"></a>プラグインの検証
単一の時間エントリ レコードで使用する場合よりも多くのコンテキストを必要とする検証の場合、またはグリッド内のインライン更新で実行する検証の場合は、プラグイン検証を使用する必要があります。 検証を完了するには、**時間エントリ** のエンティティに対してカスタム プラグインを作成します。

> [!IMPORTANT] 
> 現在、TBX のページに関する既知の問題によって、更新の際にプラグインの検証に失敗すると情報収集や [完了] の再選択ができない状況です。 回避策として、この状況をできる限り防ぐため、ビジネス ルール検証をセットアップします。


[!INCLUDE[footer-include](../includes/footer-banner.md)]