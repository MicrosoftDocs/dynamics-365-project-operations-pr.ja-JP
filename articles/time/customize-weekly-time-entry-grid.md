---
title: 時間エントリを拡張する
description: この記事では、開発者が時間入力制御を拡張する方法について説明します。
author: stsporen
ms.date: 01/27/2022
ms.topic: article
ms.reviewer: johnmichalak
ms.author: stsporen
ms.openlocfilehash: 7ed501af3fb2059ab3c3ab6f6c957fe518595d55
ms.sourcegitcommit: 6cfc50d89528df977a8f6a55c1ad39d99800d9b4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/03/2022
ms.locfileid: "8914776"
---
# <a name="extending-time-entries"></a>時間エントリを拡張する

_**適用対象 :** リソース/非在庫ベースのシナリオに使用するプロジェクト オペレーション、見積請求に対応する小規模のデプロイ_

Dynamics 365 Project Operations には、拡張可能な時間入力カスタム コントロールが含まれています。 このコントロールには次の機能が含まれます:

- 1 週間にわたって水平方向に時間を入力する
- 日、行、または週ごとを合計する
- 行または週をコピーする
- HH:mm または HH.hh を使用した時間エントリ (自動的に HH.hh に変換)
- 割り当て、予約、または予定からインポートする

時間エントリの拡張は、次の 2 つの領域で可能です:
- [個人で使用するカスタム時間エントリの追加](#add)
- [週単位の時間エントリ コントロールのカスタマイズ](#customize)

## <a name="add-custom-time-entries-for-your-own-use"></a><a name="add"></a>個人で使用するカスタマイズされた時間エントリを追加します

時間エントリは、複数のシナリオで使用されるコア エンティティです。 2020 年 4 月の リリース サイクル 1 では、TESA コア ソリューションが導入されました。 TESA では **設定** エンティティ、と新しい **時間入力ユーザー** セキュリティ ロールを提供しています。 また、**msdyn_duration** と直接関係のある **msdyn_start** と **msdyn_end** という新しいフィールドも追加されました。 新しいエンティティ、セキュリティ ロールおよびフィールドにより、複数の製品にわたる時間へのより統一されたアプローチが可能になります。


### <a name="time-source-entity"></a>時間ソース エンティティ
| フィールド | 内容 | 
|-------|------------|
| 件名  | 時間エントリを作成する際に選択値として使用する時間ソース エントリの名前です。 |
| 既定の時間ソース [時間ソース: isdefault] | 既定では、時間ソースは 1 つしかマークできません。 これは、時間ソースが指定されていない場合に、エントリを既定の時間ソースにすることができます。 |
|時間ソースの種類 [時間ソース: sourcetype] | ソースの種類は、時間ソースをアプリに関連付けることを可能にするオプション (時間エントリ ソースの種類) です。 Microsoft では 190,000,000 超の値を確保していることに注意してください。|


### <a name="time-entries-and-the-time-source-entity"></a>時間エントリと時間ソース エンティティ
各時間エントリは、時間ソース レコードに関連付けられています。 このレコードは、どのアプリケーションがどのように時間エントリを処理すべきかを決定します。

時間エントリは常に、開始、終了、および期間がリンクされた 1 つの継続的な時間ブロックです。

ロジックでは、次の状況で時間エントリ レコードを自動的に更新します:

- 次の 3 つのフィールドのうち 2 つが指定されている場合、3 番目のフィールドは自動的に計算されます: 

    - **msdyn_start**
    - **msdyn_end**
    - **msdyn_duration**

- **msdyn_start** と **msdyn_end** フィールドはタイムゾーンに対応しています。
- **msdyn_date** と **msdyn_duration** のみを指定して作成された時間項目は、深夜から開始されます。 **msdyn_start** と **msdyn_end** のフィールドはタイムゾーンに応じて更新されます。

#### <a name="time-entry-types"></a>時間エントリの種類

時間エントリ レコードには、関連するアプリケーションの送信フローでの動作を定義する関連するタイプがあります。

|ラベル | 値|
|-----|-----|
|休憩中   |192,355,000|
|移動 | 192,355,001|
|残業   | 192,354,320|
|作業   | 192,350,000|
|不在    | 192,350,001|
|休暇   | 192,350,002|


## <a name="customize-the-weekly-time-entry-control"></a><a name="customize"></a>週単位の時間エントリ コントロールをカスタマイズする
開発者は、他のエンティティに追加のフィールドと検索を追加し、ビジネス シナリオをサポートするユーザー定義のビジネス ルールを実装できます。

### <a name="add-custom-fields-with-lookups-to-other-entities"></a>他のエンティティに検索付きのカスタム フィールドを追加する
毎週の時間エントリのグリッドにカスタム フィールドを追加する場合、3 つの重要な手順があります。

1. カスタム フィールドを **簡易作成** ダイアログ ボックスに追加します。
2. グリッドを構成し、カスタム フィールドを表示します。
3. 必要に応じて、カスタム フィールドを **行編集** または **時間エントリの編集** にページ追加します。

**行の編集** または **時間エントリの編集** ページで、新しいフィールドに必要な検証が設定されていることを確認します。 このタスクの一環として、時間エントリの状態に基づいて、フィールドをロックします。

カスタム フィールドを **時間エントリ** グリッドに追加し、グリッドで直接時間エントリを作成すると、それらのエントリのカスタム フィールドは、行と一致するように自動的に設定されます。 

### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>カスタム フィールドを簡易作成ダイアログ ボックスに追加します
**簡易作成: 時間エントリ作成** ダイアログ ボックス にカスタム フィールドを追加する必要があります。 次に、ユーザーは **新規** を選択して時間エントリを追加するときに値を入力できます。

### <a name="configure-the-grid-to-show-the-custom-field"></a>グリッドを構成し、カスタム フィールドを表示します。
**週単位の時間エントリ** グリッドにカスタム フィールドを追加する 2 つの手順があります。

- **週単位の自分の時間エントリ** ビューをカスタマイズし、カスタム フィールドを追加します。 ビューのプロパティを編集することで、グリッド内のカスタム フィールドの位置とサイズを指定することができます。
- 新しい時間エントリのカスタム ビューを作成し、既定のビューとして設定します。 このビューでは、グリッド内の目的の列に加えて、さらに **説明** と **外部コメント** フィールドを含める必要があります。 ビューのプロパティを編集することで、グリッドの位置、サイズ、既定のソート順を指定することができます。 次に、**時間エントリ グリッド** コントロールになるように、このビューのカスタム コントロールを設定します。 このコントロールをビューに追加して、**Web**、**携帯電話**、**タブレット** を選択します。 次に、**毎週の時間エントリ** グリッドのパラメーターを構成します。 **開始日** フィールドを **msdyn\_date** に設定し、**期間** フィールドを **msdyn\_duration** に設定し、 **状態** フィールドを **msdyn\_entrystatus** に設定します。 **読み取り専用ステータス リスト** フィールドは、**192350002 (承認済み)**、**192350003 (提出済み)**、また **192350004 (リコール要求)** に設定されます。

### <a name="add-the-custom-field-to-the-appropriate-edit-page"></a>カスタム フィールドを適切な編集ページに追加する
時間エントリまたは時間エントリの行を編集するために使用されるページは、**フォーム** 以下にあります。 グリッドの **エントリの編集** ボタンをクリックすると、**エントリの編集** ページが開き、**行を編集** ボタンをクリックすると **行の編集** ページが開きます。 これらのページを編集して、カスタム フィールドを含めることができます。

これらのオプションは両方とも、**プロジェクト** および **プロジェクト タスク** エンティテイの標準フィルターを削除して、エンティティのすべての検索ビューを表示できるようにします。 標準ボックスで、関連する検索ビューのみ表示されます。

カスタム フィールド向けの適切なページを決定する必要があります。 ほとんどの場合、フィールドをグリッドに追加すると、**行編集** ページに移動します。これは、時間エントリ行全体に適用するフィールドで使用されます。 カスタム フィールドが毎日一意の値を行に持つ場合 (たとえば、終了時間のカスタム フィールドの場合)、**時間エントリの編集** ページに表示されます。

タスク フローにカスタム フィールドを追加するには、**フィールド** 要素をページの適切な場所にドラッグし、プロパティを設定します。

### <a name="add-new-option-set-values"></a>新しいオプション セット値を追加する
既成のフィールドにオプション セット値を追加するには、次の手順に従います。

1. フィールドの編集ページを開き、**種類** で、オプション セットの横にある **編集** を選択します。
2. カスタム ラベルとカラーを持つ新しいオプションを追加します。 新しい時間エントリの状態を追加する場合、既成のフィールドは **エントリー状態** という名前になります。

### <a name="designate-a-new-time-entry-status-as-read-only"></a>読み取り専用として、新しい時間エントリ状態を指定します。
読み取り専用として新しい時間エントリ条件を指定するには、**読み取り専用状態のリスト** プロパティに新しい時間エントリ値を追加します。 ラベルではなく、必ず番号を追加してください。 時間エントリ グリッドの編集可能な部分は、新しい状態を持つ行に対してロックされます。 **読み取り専用状態リスト** のプロパティを **時間エントリ** ビューごとに異なるように設定するには、ビューの **カスタム コントロール** セクションに **時間エントリ** グリッドを追加し、適切なパラメータを構成します。

次に、**行の編集** および **時間エントリの編集** ページで、すべてのフィールドをロックするビジネス ルールを追加します。 これらのページのビジネス ルールにアクセスするには、各ページのフォームエディタを開き、**ビジネス ルール** を選択します。 既存のビジネス ルールの状況で新しい状態を追加できます。または、新規の状態用に新しいビジネス ルールを追加できます。

### <a name="add-custom-validation-rules"></a>カスタム検証ルールを追加する
**毎週の時間エントリ** グリッド エクスペリエンスには、2種類の検証ルールを追加することができます:

- ページで機能するクライアント側のビジネスルール
- すべての時間エントリの更新に適用されるサーバー側のプラグイン検証

#### <a name="client-side-business-rules"></a>クライアント側のビジネス ルール
ビジネス ルールを使用して、フィールドのロックおよびロック解除を行い、既定値をフィールドに入力し、現在の時間エントリ レコードからの情報のみを必要とする検証を定義します。 ページのビジネス ルールにアクセスするには、フォーム エディタを開き、**ビジネス ルール** を選択します。 これで、既存のビジネス ルールの編集または新しいビジネス ルールの追加ができるようになります。

#### <a name="server-side-plug-in-validations"></a>サーバー側のプラグインの検証
1 つの時間エントリ レコードで利用可能な以上のコンテキストを必要とする検証には、プラグインの検証を使用する必要があります。 グリッドのインライン更新で実行する検証にも使用する必要があります。 検証を完了するには、**時間エントリ** のエンティティに対してカスタム プラグインを作成します。

### <a name="limits"></a>制限
現在、**時間入力** グリッドのサイズ制限は 500 行です。 500 行を超える場合、超過した行は表示されません。 このサイズ制限を増やす方法はありません。

### <a name="copying-time-entries"></a>時間エントリのコピー
時間入力中にコピーするフィールドのリストを定義するには、**時間エントリ列のコピー** ビューを使用します。 **日付** と **期間** は必須フィールドのため、ビューから削除しないでください。


[!INCLUDE[footer-include](../includes/footer-banner.md)]
