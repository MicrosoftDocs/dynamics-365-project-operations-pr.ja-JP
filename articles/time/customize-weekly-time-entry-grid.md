---
title: 時間エントリを拡張する
description: このトピックでは、開発者が時間エントリ コントロールを拡張する方法について説明します。
author: stsporen
ms.date: 10/08/2020
ms.topic: article
ms.reviewer: kfend
ms.author: stsporen
ms.openlocfilehash: c36a47b09e6012925a047f81318e89167d5c506facaae8d72b0bb6e8e267a7d5
ms.sourcegitcommit: 7f8d1e7a16af769adb43d1877c28fdce53975db8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/06/2021
ms.locfileid: "6993337"
---
# <a name="extending-time-entries"></a>時間エントリを拡張する

_**適用対象 :** リソース/非在庫ベースのシナリオに使用するプロジェクト オペレーション、見積請求に対応する小規模のデプロイ_

Dynamics 365 Project Operations には、拡張可能な時間入力カスタム コントロールが含まれています。 このコントロールには次の機能が含まれます:

- 1 週間にわたって水平方向に時間を入力する
- 日、行、または週ごとを合計する
- 行または週をコピーする
- HH:mm または HH.hh を使用した時間エントリ (自動的に HH.hh に変換)
- 割り当て、予約、または予定からインポートする

時間エントリの拡張は、次の 2 つの領域で可能です:
- [個人で使用するカスタム時間エントリの追加](#add)
- [週単位の時間エントリ コントロールのカスタマイズ](#customize)

## <a name="add-custom-time-entries-for-your-own-use"></a><a name="add"></a>個人で使用するカスタマイズされた時間エントリを追加します

時間エントリは、複数のシナリオで使用されるコア エンティティです。 2020 年 4 月の リリース サイクル 1 では、TESA コア ソリューションが導入されました。 TESA では **設定** エンティティ、と新しい **時間入力ユーザー** セキュリティ ロールを提供しています。 また、**msdyn_duration** と直接関係のある **msdyn_start** と **msdyn_end** という新しいフィールドも追加されました。 新しいエンティティ、セキュリティ ロールおよびフィールドにより、複数の製品にわたる時間へのより統一されたアプローチが可能になります。


### <a name="time-source-entity"></a>時間ソース エンティティ
| フィールド | 内容 | 
|-------|------------|
| 件名  | 時間エントリを作成する際に選択値として使用する時間ソース エントリの名前です。 |
| 既定の時間ソース [時間ソース: isdefault] | 既定では、時間ソースは 1 つしかマークできません。 これは、時間ソースが指定されていない場合に、エントリを既定の時間ソースにすることができます。 |
|時間ソースの種類 [時間ソース: sourcetype] | ソースの種類は、時間ソースをアプリに関連付けることを可能にするオプション (時間エントリ ソースの種類) です。 Microsoft では 190,000,000 超の値を確保していることに注意してください。|


### <a name="time-entries-and-the-time-source-entity"></a>時間エントリと時間ソース エンティティ
各時間エントリは、時間ソース レコードに関連付けられています。 このレコードは、どのアプリケーションが時間エントリをどう処理するかを決定します。

時間エントリは常に、開始、終了、および期間がリンクされた 1 つの継続的な時間ブロックです。

ロジックでは、次の状況で時間エントリ レコードを自動的に更新します:

- 次の 3 つのフィールドのうち 2 つが指定されている場合、3 番目のフィールドは自動的に計算されます: 

    - **msdyn_start**
    - **msdyn_end**
    - **msdyn_duration**

- **msdyn_start** および **msdyn_end** のフィールドはタイムゾーンに対応しています。
- **msdyn_date** と **msdyn_duration** のみを指定して作成された時間項目は、深夜から開始されます。 **msdyn_start** と **msdyn_end** のフィールドはタイムゾーンに応じて更新されます。

#### <a name="time-entry-types"></a>時間エントリの種類

時間エントリ レコードには、関連するアプリケーションの送信フローでの動作を定義する関連するタイプがあります。

|ラベル | 値|
|-----|-----|
|休憩中   |192,355,000|
|移動 | 192,355,001|
|残業   | 192,354,320|
|作業   | 192,350,000|
|不在    | 192,350,001|
|休暇   | 192,350,002|



## <a name="customize-the-weekly-time-entry-control"></a><a name="customize"></a>週単位の時間エントリ コントロールをカスタマイズする
開発者は、他のエンティティに追加のフィールドと検索を追加し、ビジネス シナリオをサポートするユーザー定義のビジネス ルールを実装できます。

### <a name="add-custom-fields-with-lookups-to-other-entities"></a>他のエンティティに検索付きのカスタム フィールドを追加する
毎週の時間エントリのグリッドにカスタム フィールドを追加する場合、3 つの重要な手順があります。

1. カスタム フィールドを簡易作成ダイアログ ボックスに追加します。
2. グリッドを構成し、カスタム フィールドを表示します。
3. 行編集タスク フローまたはセル編集タスク フローにカスタムフィールドを追加します。

新しいフィールドが、行やセル編集タスク フローで必要な検証がされていることを確認します。 この手順の一部として、時間の入力状態に基づいてフィールドをロックします。

### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>カスタム フィールドを簡易作成ダイアログ ボックスに追加します。
**時間エントリの簡易作成** ダイアログ ボックスにカスタム フィールドを追加する必要があります。 時間エントリが追加されたときに、**新規** を選択することで、値を入力することができます。

### <a name="configure-the-grid-to-show-the-custom-field"></a>グリッドを構成し、カスタム フィールドを表示します。
週単位の時間エントリのグリッドにカスタム フィールドを追加する 2 つの手順があります:

  - ビューをカスタマイズし、カスタム フィールドを追加する
  - 既定の新しいカスタム時間エントリを作成する 


#### <a name="customize-a-view-and-add-a-custom-field"></a>ビューをカスタマイズし、カスタム フィールドを追加する

**週単位の自分の時間エントリ** ビューをカスタマイズし、カスタム フィールドを追加します。 ビューのプロパティを編集することで、グリッド内のカスタム フィールドの位置とサイズを選択することができます。

#### <a name="create-a-new-default-custom-time-entry"></a>既定の新しいカスタム時間エントリを作成する

このビューでは、グリッド内の目的の列に加えて、さらに **説明** および **外部コメント** フィールドを含める必要があります。 

1. ビューでこれらのプロパティを編集することによって、グリッドの場所、サイズ、既定の並べ替え順序を選択します。 
2. **時間エントリ グリッド** コントロールになるように、このビューのカスタム コントロールを構成します。 
3. このコントロールをビューに追加して、Web、携帯電話、タブレットを選択します。 
4. 週単位の時間エントリ グリッドのパラメーターを構成します。 
5. **開始日** フィールドを **msdyn_date** に設定し、**期間** フィールドを **msdyn_duration** に設定し、**msdyn_entrystatus** に **状態** フィールドを設定します。 
6. 既定のビューの場合、**読み取り専用の状態リスト** フィールドは **192350002,192350003,192350004** に設定されます。 **行編集タスク フロー** フィールドは **msdyn_timeentryrowedit** に設定されます。 **セル編集タスク フロー** フィールドは **msdyn_timeentryedit** に設定されます。 
7. これらのフィールドをカスタマイズして、読み取り専用の状態を追加あるいは削除したり、行またはセルの編集用に別のタスク ベーのエクスペリエンス (TBX) を使用したりできます。 これらのフィールドは静的な値にバインドされます。


> [!NOTE] 
> どちらのオプションも、**プロジェクト** と **プロジェクト タスク** のエンティティのフィルタリングを削除して、エンティティのすべてのルックアップビューが表示できるようにします。 標準ボックスで、関連する検索ビューのみが表示されます。

カスタム フィールドで使用する適切なタスクフローを決定します。 グリッドにフィールドを追加した場合、そのフィールドは、時間エントリの行全体に適用されるフィールドに使用される行編集タスクフローに入ります。 カスタム フィールドでは、毎日、**終了時刻** のカスタム フィールドのように一意の値が生成され、一意の値は [セル編集タスク フロー] に移動します。

タスク フローにカスタム フィールドを追加するには、**フィールド** 要素をページの適切な場所にドラッグしてから、フィールド プロパティを設定します。 **ソース** プロパティを **時間エントリ** に設定して、カスタム フィールドに **データ フィールド** プロパティを設定します。 **フィールド** プロパティでは、TBX ページに表示名を指定できます。 **適用** を選択してフィールドへの変更を保存してから、**更新** を選択してページへの変更を保存します。

新しいユーザー定義の TBX ページを使用するには、新しいプロセスを作成します。 カテゴリを **ビジネス プロセス フロー** に設定し、エンティティを **時間エントリ** に設定し、ビジネス プロセスの種類を **タスク フローとしてプロセスを実行する** に設定します。 **プロパティ** で、**ページ名** プロパティは、そのページの表示名に設定されています。 TBX のページに、すべての関連フィールドを追加します。 保存してプロセスをアクティブ化します。 関連するタスクフローのカスタム コントロール プロパティをプロセス上の **名前** の値に更新します。

### <a name="add-new-option-set-values"></a>新しいオプション セット値を追加する
オプション セットの値を既成のフィールドに追加するには、フィールドの編集ページを開き、、**種類** の下のオプショ ンセットの横にある **編集** を選択します。 カスタム ラベルとカラーを持つ新しいオプションを追加します。 新しい時間エントリの状態を追加する場合、既成のフィールドは、**状態** ではなく、**入力の状態** という名前になります。

### <a name="designate-a-new-time-entry-status-as-read-only"></a>読み取り専用として、新しい時間エントリ状態を指定します。
読み取り専用として新しい時間エントリ条件を指定するには、**読み取り専用状態のリスト** プロパティに新しい時間エントリ値を追加します。 時間エントリ グリッドの編集可能な部分は、新規の状態になっている行にロックされます。
次に、**時間エントリ行を編集する** および **時間エントリ編集** の TBX のページで、すべてのフィールドをロックするビジネス ルールを追加します。 ページのビジネス プロセス フロー エディターを開いて **ビジネス ルール** を選択すると、これらのページに関するビジネス ルールにアクセスできます。 既存のビジネス ルールの状況で新しい状態を追加できます。または、新規の状態用に新しいビジネス ルールを追加できます。

### <a name="add-custom-validation-rules"></a>カスタム検証ルールを追加する
週単位の時間エントリ グリッド エクスペリエンスに追加できる検証ルールには、次の 2 種類があります:

- 簡易作成ダイアログ ボックスおよび TBX ページで機能するクライアント側のビジネス ルール。
- すべての時間エントリの更新に適用されるサーバー側のプラグイン検証。

#### <a name="business-rules"></a>ビジネス ルール
ビジネス ルールを使用して、フィールドのロックおよびロック解除を行い、既定値をフィールドに入力し、現在の時間エントリ レコードからの情報のみを必要とする検証を定義します。 TBX ページのビジネス ルールにアクセスするには、ページのビジネス プロセス フロー エディターを開き、 **ビジネス ルール** を選択します。 これで、既存のビジネス ルールの編集または新しいビジネス ルールの追加ができるようになります。 さらにカスタマイズされた検証では、JavaScript を実行するビジネス ルールを使用できます。

#### <a name="plug-in-validations"></a>プラグインの検証
ひとつの時間エントリ レコードで利用可能なコンテクストよりも多くのコンテクストを必要とする検証や、グリッドのインライン更新で実行する検証には、プラグイン検証を使用する必要があります。 検証を完了するには、**時間エントリ** のエンティティに対してカスタム プラグインを作成します。

### <a name="copying-time-entries"></a>時間エントリのコピー
時間入力中にコピーするフィールドのリストを定義するには、**時間エントリ列のコピー** ビューを使用します。 **日付** と **期間** は必須フィールドのため、ビューから削除しないでください。


[!INCLUDE[footer-include](../includes/footer-banner.md)]